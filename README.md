# highload_avito
## РПЗ по предмету "Проектирование высоконагруженных систем". Технопарк, осень 2021
Авито - интернет-сервис для размещения объявлений о товарах, недвижимости, вакансиях и резюме на рынке труда, а также услугах от частных лиц и компаний [1].

### 1. Тема и целевая аудитория
#### MVP
Основной функционал сервиса:
* Поиск объявлений (по словам, категориям, в определенном радиусе поиска).
* Просмотр объявления.
* Публикация объявления, закрытие.
* Просмотр и редактирование личного профиля.
* Чат между покупателем и продавцом.
* Оставление отзыва на продавца.
#### Целевая аудитория
На состояние июня 2021 года месячная аудитория сервиса (desktop&mobile) составляет 41 444.9 тыс. чел. Дневная - 9 989.2 тыс. чел. [2].
Основной целевой аудиторией являтся люди в возрасте от 25 до 44 лет, большей частью специалисты и рабочее население. Сервис ориентирован на жителей РФ.

#### 2. Расчет нагрузки

##### Продуктовые метрики

* **Месячная аудитория** - 41 444.9 тыс. чел.
* **Дневная аудитория** - 9 989.2 тыс. чел.
* **Средний размер хранилища пользователя**
Существуют следующие типы хранимой информации:
1. **Личный профиль**, содержащий аватар а также данные - уникальный идентификатор, адрес электронной почты, имя, город, номер телефона, пароль.

| Аватар       | Личные данные      | Всего данных  |
| :-------------:|:------------------:| :-------:|
| 500 Кб       | 500 б              | 0.49 Мб |

3. **Чаты**. В среднем, для того, чтобы уточнить вопросы по товару, а также договориться о встрече, требуется около 10 сообщений от одного человека. Каждое сообщение в контексте чата занимает ~100 символов -> 100 байт. Вместе с дополнительной возможной информацией (id получателя и отправителя, время и проч.) получается ~1200 байт на человека. 

| Сообщение | Дополнительная информация |  Количество сообщений | Всего данных  |
| :-------------:|:------------------:| :-------:| :---: |
| 100 б       | 20 б  |  10 |   0.00114 Мб |

5. **Объявления**. Среднее описание товара составляет ~600 символов -> 600 байт + ~20 байт на дополнительную информацию (категория, состояние, продавец и проч.)  => 620 байт. Также в каждом объявлении в среднем содержится 5 изображений. Если взять средний размер за 500 Кб, то еще 2 560 000 байт. Итого 2 560 620 байт.

| Описание | Дополнительная информация |  Изображение | Количество изображений | Всего данных  |
| :-------------:|:------------------:| :-------:| :---: | :---: |
| 600 б       | 20 б  |  500 Кб |   5  | 2.44 Мб |

7. **Отзывы**. В отзывах ~150 символов + дополнительные данные об отправителе/о ком оставили отзыв. ~170 байт.

| Данные       | Дополнительная информация     | Всего данных  |
| :-------------:|:------------------:| :-------:|
| 150 б       | 20 б              | 0.00016 Мб |

Если считать, что за время существования авито (10 лет) [3] публиковалось примерно по 400 тыс. новых объявлений в день, то текущее количество закрытых объявлений составляет ~1.46 млрд - около 35 закрытых объявлений на пользователя, если считать месячную аудиторию. Можно убедиться, что эта цифра приблизительна равна действительной, так как в среднем у пользователя есть 10-15 закрытых объявлений; в то же время попадаются как пользователи, закрывшие 50-100 объявлений, так и пользователи, которые закрыли 1-5 объявлений.

На 19.09.2021 На авито размещено 78 971 675 объявлений [3]. С той же месячной аудиторией это около 2 актуальных объявлений на человека

Всего получаем 37 объявлений на человека. 

| Размер объявления       | Закрытые объявления     | Актуальные объявления   | Всего данных
| :-------------:|:------------------:| :-------:|:-------:|
| 2.44 Мб      | 35              | 2 | 90 Мб

Если на каждое объявление существовал чат с ~3 покупателями, то это 111 чатов у одного пользователя. (111 * 1200) / (1024 * 1024) = 0.13 Мб

| Количество чатов у пользователя     | Размер чата | Всего данных
| :------------------:| :-------:|:-------:|
| 111              | 0.00114 Мб |  0.13 Мб

Пусть на каждое закрытое объявление пользователю оставляли отзыв. Тогда у каждого человека по 35 отзывов => 0.005 Мб.

| Количество отзывов у пользователя     | Размер отзыва|  Всего данных
| :------------------:| :-------:|:-------:|
| 35              | 0.00016 Мб |  0.005 Мб

Таким образом, среднее хранилище пользователя представляет из себя следующее
| Профиль | Чаты | Объявления | Отзывы | Всего
|:---:|:---:|:---:|:---:|:---:|
| 0.49 Мб | 90 Мб | 0.13 Мб | 0.005 Мб | **90.625 Мб**|

##### Среднее количество действий пользователя по типам в день 

Всего в месяц на авито на момент августа 2021 года приходится 296.69 млн. посещений => 9.57 млн. посещений в день. Среднее время сессии составляет 11:25, за это время посещаются 11.79 страниц [4].

###### Поиск
В среднем, человек обычно ищет какую-то определенную вещь, также возможно, его не устраивает результат запроса и он отправляет уточненный запрос, то есть осуществляет 2 запроса по поиску.

###### Просмотр объявления
Исходя из данных выше, пользователь просматривает ~10 объявлений.

###### Публикация объявления, закрытие.
На авито каждый день публикуется 400 000 объявлений и совершается 120 сделок в минуту[3]. 
400 000 / 24 / 60 / 60 = 5 объявлений/с. Если делить на дневную аудиторию, то 0.04 объявления на человека в день, то есть 4 человека из 100 в день опубликуют объявления.
120 / 60 = 2 сделки/с => закрытие. Если делить на дневную аудиторию, то 0.017 объявления на человека в день, то есть ~2 человека из 100 закроют объявление.

###### Просмотр и редактирование личного профиля.
Нагрузка от редактирования личного профиля будет минимальной, пользователи редко правят свои данные. Но при этом покупатель чаще всего будет интересоваться профилем продавца. Если считать по просмотренным страницам объявлений, то пользователь посетит примерно 3-5 профилей.

###### Чаты
Пусть чаты привязаны к просмотренным объявлением. Допустим, пользователь заинтересовался третью просмотренных товаров, то есть начал 3 чата. В среднем, получится 6 сообщений на пользователя в сессию. У пользователя в день чаще всего одна сессия (отношения посещений к дневной аудитории ~ 1).

##### Оставление отзыва на продавца
Привязано к совершенным сделкам. Допустим, что каждый покупатель оставляет отзыв на продавца. Это будут те же 0.017 отзывов на человека в день, то есть ~2 человека из 100 оставляют отзыв.

**Итого**
| Поиск | Просмотр объявления | Публикация объявления | Закрытие объявления | Просмотр профиля | Написание сообщения | Написание отзыва |
| :---: | :---: | :---: | :---: | :---: | :---: | :---: |
| 2 | 10 | 0.04 | 0.017 | 4 | 6 | 0.017 |

##### Технические метрики
* Размер хранения в разбивке по типам данных (в Тб) - для существенных блоков данных.
Существенные блоки данных - объявления, профили, сообщения, отзывы.
1. Объявления = (78 971 675 + 1 460 000 000) * 2.44 Мб / 1024 / 1024 = 3 581 Тб
2. Профили (возьмем месячную аудиторию за существующую) = 41 444 900 * 0.49 Мб / 1024 / 1024 = 19.4 Тб
3. Сообщения (аналогично) = 41 444 900 * 0.13 Мб / 1024 / 1024 = 5.14 Тб
4. Отзывы (аналогично) = 41 444 900 * 0.05 Мб / 1024 / 1024 = 2 Тб

* Сетевой трафик
Основной трафик
1. Загрузка информации об объявлении (в т.ч на странице поиска) = (10 {объявления, просмотренные одним человеком} * 9 989 200 * 2.44 Мб  + 9 {картинок на странице поиска} * 2 {запросы поиска} * 5 {в среднем пролистнул страниц пользователь} * 0.49 Мб {картинка + данные короткие об объявлении} * 9 989 200) / 24 / 60 / 60 / 1024 = (243 736 480 + 440 523 720) / 24 / 60 / 60 / 1024 = 7.7 Гб/с
2. Загрузка профилей = 9 989 200 * 4 {профили} * 0.49 / 24 / 60 / 60 / 1024 = 0.22 Гб/c
Итого 684 288 Гб/cутки
* RPS в разбивке по типам запросов

| Тип запроса | RPS |
| :---: | :---: |
| Авторизация | 145 |  
| Поиск | 231 |
| Объявления (страницы) | 1155 |
| Объявления (отдельное) | 1156 |
| Публикация объявления | 5 |
| Закрытие объявления | 2 |
| Просмотр профиля | 462 |
| Просмотр отзывов | 462 |
| Оставление отзыва | 2 |
| Написание сообщения | 694 |
| Получение сообщений чата | 694 |
| **Итого** | **5008** |

#### 3. Логическая схема

#### 4. Физическая схема

#### 5. Технологии

#### 6. Схема проекта

#### 7. Список серверов

#### Список использованных источников

1. https://ru.wikipedia.org/wiki/%D0%90%D0%B2%D0%B8%D1%82%D0%BE
2. https://webindex.mediascope.net/report?byGeo=2&byDevice=3&byDevice=1&byDevice=2&byMonth=202106&id=15828
3. https://www.avito.ru/company
4. https://www.similarweb.com/ru/website/avito.ru/#overview
